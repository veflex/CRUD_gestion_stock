"use strict";var app=function(){var m={},t=[],i="http://localhost:8081/",d=[],e=[],o=function(e,t,n,d){try{var i=new XMLHttpRequest;if(i.open(t,e),i.setRequestHeader("Content-Type","application/json"),d=d?JSON.stringify(d):null,"post"===t.toLowerCase()&&!d)throw new Error("bad call");i.onload=function(e){return n(e.target.response||e.srcElement.response)},i.send(d)}catch(e){console.error(e)}},l=function(e){t=[],e.forEach(function(e){t.push(e.parentElement.parentElement.id)})},c=function(e){var t=document.querySelectorAll(e);return Array.from(t).filter(function(e){return!0===e.checked})},r=function(e){e.forEach(function(e){e.classList.toggle("is-hidden")})},n=function(e){e.classList.toggle("is-hidden")},a=function(e){var t=document.createElement("tr"),n=document.createElement("td"),d=document.createElement("td"),i=document.createElement("td"),o=document.createElement("td"),l=document.createElement("td"),c=document.createElement("td"),r=document.createElement("td"),a=document.createElement("i"),s=document.createElement("i"),u=document.createElement("input");u.type="checkbox",a.className="far fa-edit fa-2x modify",s.className="fas fa-check fa-2x valid is-hidden",t.id=e.id,n.innerHTML=e.id,d.innerHTML=e.nom,i.innerHTML=e.nom_marque,o.innerHTML=e.description,l.innerHTML=e.prix,t.contentEditable="false",n.contentEditable="false",c.contentEditable="false",r.contentEditable="false",i.contentEditable="false",c.appendChild(s),c.appendChild(a),r.appendChild(u),c.appendChild(a),t.appendChild(n),t.appendChild(d),t.appendChild(i),t.appendChild(o),t.appendChild(l),t.appendChild(c),t.appendChild(r),m.tbody.appendChild(t)},s=function(){l(c("#tbodyProd input")),o(i+"api/v1/produits","DELETE",function(e){window.console.log(e)},{ids:t}),t.forEach(function(e){document.getElementById(e).remove()})},u=function(e){var t=document.getElementById(e);return{id:e,nom:t.cells[1].innerHTML,description:t.cells[3].innerHTML,prix:t.cells[4].innerHTML}},p=function(e,t){var n=document.querySelectorAll(e),d=document.querySelectorAll(t);n.forEach(function(e){e.addEventListener("click",function(){e.parentElement.parentElement.cells[1].classList.add("highlight"),e.parentElement.parentElement.cells[3].classList.add("highlight"),e.parentElement.parentElement.cells[4].classList.add("highlight"),e.parentElement.parentElement.contentEditable="true",e.classList.add("is-hidden"),e.previousElementSibling.classList.remove("is-hidden")})}),d.forEach(function(t){t.addEventListener("click",function(){t.parentElement.parentElement.cells[1].classList.remove("highlight"),t.parentElement.parentElement.cells[3].classList.remove("highlight"),t.parentElement.parentElement.cells[4].classList.remove("highlight"),t.parentElement.parentElement.contentEditable="false",t.classList.add("is-hidden"),t.nextElementSibling.classList.remove("is-hidden");var e=t.parentElement.parentElement.id;o(i+"api/v1/produits","PATCH",function(e){window.console.log(JSON.parse(e))},u(e))})})},E=function(){o(i+"api/v1/produits","GET",function(e){var t;t=JSON.parse(e),r(d),m.tbody.innerHTML="",t.forEach(function(e){a(e)}),p("#tbodyProd i.modify","#tbodyProd i.valid")})},f=function(e){e.preventDefault();var t={nom:m.nom.value,nom_marque:m.marque.value,description:m.description.value,prix:m.prix.value};o(i+"api/v1/produits","POST",function(e){t.id=JSON.parse(e).insertId,document.querySelectorAll("#marques option").forEach(function(e){t.nom_marque===e.value&&(t.nom_marque=e.label)}),a(t),p("#tbodyProd i.modify","#tbodyProd i.valid")},t)},h=function(e,t){var n=document.querySelectorAll(t);e.checked?n.forEach(function(e){e.checked=!0}):n.forEach(function(e){e.checked=!1})},v=function(e){e.preventDefault();var t={nom:m.nomM.value};o(i+"api/v1/marques","POST",function(e){t.id=JSON.parse(e).insertId,y(t),L("#tbodyMarques i.modify","#tbodyMarques i.valid"),g(t.nom,t.id)},t)},y=function(e){var t=document.createElement("tr"),n=document.createElement("td"),d=document.createElement("td"),i=document.createElement("td"),o=document.createElement("td"),l=document.createElement("i"),c=document.createElement("i"),r=document.createElement("input");r.type="checkbox",l.className="far fa-edit fa-2x modify",c.className="fas fa-check fa-2x valid is-hidden",t.id="marque_"+e.id,n.innerHTML=e.id,d.innerHTML=e.nom,t.contentEditable="false",n.contentEditable="false",i.appendChild(l),i.appendChild(c),o.appendChild(r),t.appendChild(n),t.appendChild(d),t.appendChild(i),t.appendChild(o),m.tbodyM.appendChild(t)},g=function(e,t){var n=document.createElement("option");n.value=t,n.innerHTML=e,m.marque.appendChild(n)},L=function(e,t){var n=document.querySelectorAll(e),d=document.querySelectorAll(t);n.forEach(function(e){e.addEventListener("click",function(){e.parentElement.parentElement.cells[1].classList.add("highlight"),e.parentElement.parentElement.contentEditable="true",e.classList.add("is-hidden"),e.nextElementSibling.classList.remove("is-hidden")})}),d.forEach(function(t){t.addEventListener("click",function(){t.parentElement.parentElement.cells[1].classList.remove("highlight"),t.parentElement.parentElement.contentEditable="false",t.classList.add("is-hidden"),t.previousElementSibling.classList.remove("is-hidden");var e=t.parentElement.parentElement.id;M(e,b)})})},M=function(e,t){o(i+"api/v1/marques","PATCH",function(e){E(),r(d),window.console.log(JSON.parse(e))},t(e))},b=function(e){var t=document.getElementById(e);return{id:e.slice(7),nom:t.cells[1].innerHTML.replace(/(\r\n|\n|\r)/gm,"").replace(/ /g,"")}},q=function(){l(c("#tbodyMarques input"));var e=prompt("!!!! ATTENTION !!!!\n Si vous décidez de supprimer une marque, tous les produits associé seront supprimé.\nV pour valider");if(null===e)window.console.log("on fait rien");else if("v"===e.toLowerCase()){var n=[];t.forEach(function(e){n.push(e.slice(7))}),window.console.log(n),o(i+"api/v1/marques","DELETE",function(e){window.console.log(e),E(),r(d)},{ids:n}),document.querySelectorAll("#formProd option").forEach(function(t){n.forEach(function(e){e===t.value&&t.remove()})}),t.forEach(function(e){document.getElementById(e).remove()})}else window.console.log("on fait rien")};document.addEventListener("DOMContentLoaded",function(){m.table=document.getElementById("tableProd"),m.tbody=document.getElementById("tbodyProd"),m.show=document.getElementById("showProd"),m.hide=document.getElementById("hideProd"),m.plus=document.getElementById("plusProd"),m.delete=document.getElementById("deleteProd"),m.check=document.querySelector("#tableProd thead input"),m.form=document.getElementById("formProd"),m.nom=document.getElementById("nom"),m.marque=document.getElementById("marques"),m.description=document.getElementById("description"),m.prix=document.getElementById("prix"),m.btn_form=document.getElementById("btn_form"),m.tableM=document.getElementById("tableMarques"),m.tbodyM=document.getElementById("tbodyMarques"),m.showM=document.getElementById("showMarques"),m.hideM=document.getElementById("hideMarques"),m.plusM=document.getElementById("plusMarques"),m.deleteM=document.getElementById("deleteMarques"),m.checkM=document.querySelector("#tableMarques thead input"),m.formM=document.getElementById("formMarques"),m.nomM=document.getElementById("nomMarque"),m.btn_form_M=document.getElementById("btn_form_M"),d.push(m.show),d.push(m.hide),d.push(m.table),e.push(m.showM),e.push(m.hideM),e.push(m.tableM),m.show.addEventListener("click",E),m.hide.addEventListener("click",function(){r(d)}),m.check.addEventListener("change",function(){h(m.check,"#tbodyProd input")}),m.plus.addEventListener("click",function(){n(m.form)}),m.btn_form.addEventListener("click",f),m.delete.addEventListener("click",s),m.checkM.addEventListener("change",function(){h(m.checkM,"#tbodyMarques input")}),m.showM.addEventListener("click",function(){r(e)}),m.hideM.addEventListener("click",function(){r(e)}),m.plusM.addEventListener("click",function(){n(m.formM)}),m.deleteM.addEventListener("click",q),m.btn_form_M.addEventListener("click",v),L("#tbodyMarques i.modify","#tbodyMarques i.valid")})}();